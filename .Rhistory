ggplot(df.savetot ,aes( x =years, y = SSB, color = lambda ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = Bio, color = lambda ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
df.savetot <- rbind(df.save, df.save2) %>%
group_by(years, rho, M, lambda, model , SDR) %>%
summarise(Bio = median(SSB),
Biomin = quantile(SSB, probs = 0.05),
Biomax = quantile(SSB, probs = 0.95),
Rec = median(R),
Rmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95)
)
df.savetot$lambda[is.na(df.savetot$lambda)] <- 0
ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = R, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = Rec, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
head(df.savetot)
head(df.save)
df.savetot <- rbind(df.save, df.save2) %>%
group_by(years, rho, M, lambda, model , SDR) %>%
summarise(Bio = median(SSB),
Biomin = quantile(SSB, probs = 0.05),
Biomax = quantile(SSB, probs = 0.95),
Rec = median(R),
Rmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
R0 = median(R0_boff)
)
ggplot(df.savetot ,aes( x =years, y = R0, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
is.na(df.save$R0_boff)
which(is.na(df.save$R0_boff))
which(is.na(df.save2$R0_boff))
ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
df.save$SDR <- .2
df.save2$SDR <- 1
df.savetot <- rbind(df.save, df.save2) %>%
group_by(years, rho, M, lambda, model , SDR) %>%
summarise(Bio = median(SSB),
Biomin = quantile(SSB, probs = 0.05),
Biomax = quantile(SSB, probs = 0.95),
Rec = median(R),
Rmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
R0 = median(R0_boff)
)
df.savetot$lambda[is.na(df.savetot$lambda)] <- 0
ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
df.savetot <- rbind(df.save, df.save2) %>%
group_by(years, rho, M, lambda, model , SDR) %>%
summarise(Bio = median(SSB),
Biomin = quantile(SSB, probs = 0.05),
Biomax = quantile(SSB, probs = 0.95),
Rec = median(R),
Rmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
R0 = median(R0_boff)
)
df.savetot$lambda[is.na(df.savetot$lambda)] <- 1
ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = Rec, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = R0, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
ggplot(df.savetot ,aes( x =years, y = Rec, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
p1 <- ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
p2 <- ggplot(df.savetot ,aes( x =years, y = Rec, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
p3 <- ggplot(df.savetot ,aes( x =years, y = R0, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
?ggsave
p1 <- ggplot(df.savetot ,aes( x =years, y = Bio, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
p2 <- ggplot(df.savetot ,aes( x =years, y = Rec, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
p3 <- ggplot(df.savetot ,aes( x =years, y = R0, color = factor(lambda) ))+geom_line()+facet_grid(SDR ~ rho)+theme_bw()
p2
p3 <- ggplot(df.savetot ,aes( x =years, y = R0, color = factor(lambda) ))+
geom_line()+facet_grid(SDR ~ rho)+theme_bw()
p3
ggsave(filename = 'figures/9-5/biotime.png', p1, width = 16, height = 12)
ggsave(filename = 'figures/9-5/rectime.png', p2, width = 16, height = 12)
ggsave(filename = 'figures/9-5/R0time.png', p3, width = 16, height = 12)
ggplot(prop.plot[prop.plot$name == 'SSBcorRdev',], aes(x = factor(SDR), y = value, color = factor(rho)))+geom_boxplot(width = 0.1,position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(model ~ lambda)+theme_classic()
head(df.plot)
df.plot$R0base <- 1000
df.plot[df.plot$years>round(max(df.plot$years)/2),] %>%
group_by(model, run, Linf, SDR, K, tau, rho, lambda) %>%
dplyr::summarise( SSBcorRR0  = cor(SSBprop, recR0),
weightcorRR0  = cor(mweight, recR0),
agecorRR0  = cor(mage, recR0),
SSBcorRtot  = cor(SSBprop, rtot),
weightcorRtot  = cor(mweight, rtot),
agecorRtot  = cor(mage, rtot),
SSBcorRdev  = cor(SSBprop, Rresid),
weightcorRdev  = cor(mweight, Rresid),
agecorRdev  = cor(mage, Rresid),
agecorR0base = cor(mage, R0base),
SSBcorR0base = cor(SSBprop, R0base),
weightcorR0base = cor(mweight, R0base)
)
df.plot <- rbind(df.out, df.out2)
df.plot$lambda[is.na(df.plot$lambda)] <- 0
df.plot$R0base <- 1000
# Plot some stuff
prop.plot <- df.plot[df.plot$years>round(max(df.plot$years)/2),] %>%
group_by(model, run, Linf, SDR, K, tau, rho, lambda) %>%
dplyr::summarise( SSBcorRR0  = cor(SSBprop, recR0),
weightcorRR0  = cor(mweight, recR0),
agecorRR0  = cor(mage, recR0),
SSBcorRtot  = cor(SSBprop, rtot),
weightcorRtot  = cor(mweight, rtot),
agecorRtot  = cor(mage, rtot),
SSBcorRdev  = cor(SSBprop, Rresid),
weightcorRdev  = cor(mweight, Rresid),
agecorRdev  = cor(mage, Rresid),
agecorR0base = cor(mage, R0base),
SSBcorR0base = cor(SSBprop, R0base),
weightcorR0base = cor(mweight, R0base)
)
warnings()
head(df.plot)
# Plot some stuff
prop.plot <- df.plot[df.plot$years>round(max(df.plot$years)/2),] %>%
group_by(model, run, Linf, SDR, K, tau, rho, lambda) %>%
dplyr::summarise( SSBcorRR0  = cor(SSBprop, recR0),
weightcorRR0  = cor(mweight, recR0),
agecorRR0  = cor(mage, recR0),
SSBcorRtot  = cor(SSBprop, rtot),
weightcorRtot  = cor(mweight, rtot),
agecorRtot  = cor(mage, rtot),
SSBcorRdev  = cor(SSBprop, Rresid),
weightcorRdev  = cor(mweight, Rresid),
agecorRdev  = cor(mage, Rresid)
) %>%
pivot_longer(9:17)
head(prop.plot)
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_boxplot(width = 0.1,position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(name ~ lambda)+theme_classic()
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_boxplot(width = 0.1,position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_violin(width = 0.1,position = dodge)+
geom_boxplot(width = .2, position = dodge)
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_violin(width = 0.1,position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_violin(width = 0.1,position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.1,.1))
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_violin(width = 0.1,position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.2,.2))
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.2,.2))
dodge <- position_dodge(width = 0.8)
dodge <- position_dodge(width = 0.8)
ggplot(prop.plot,
aes(x = factor(SDR), y = value, color = factor(rho)))+geom_violin(position = dodge, fill = factor(rho))+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.2,.2))
dodge <- position_dodge(width = 0.8)
ggplot(prop.plot,
aes(x = factor(SDR), y = value, fill = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.2,.2))
ggplot(prop.plot,
aes(x = factor(SDR), y = value, fill = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.3,.3))
is.na(df.save$lambda)
# Plot some other things
df.save$SDR <- .2
df.save2$SDR <- 1
df.savetot <- rbind(df.save, df.save2) %>%
group_by(years, rho, M, lambda, model , SDR) %>%
summarise(Bio = median(SSB),
Biomin = quantile(SSB, probs = 0.05),
Biomax = quantile(SSB, probs = 0.95),
Rec = median(R),
Rmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
R0 = median(R0_boff)
)
df.savetot$lambda[is.na(df.savetot$lambda)] <- 1
dodge <- position_dodge(width = 0.8)
ggplot(prop.plot,
aes(x = factor(SDR), y = value, fill = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.3,.3))
ggplot(prop.plot,
aes(x = factor(SDR), y = value, fill = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.4,.4))
ggplot(prop.plot,
aes(x = factor(SDR), y = value, fill = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.4,.4))+
scale_y_continuous('correlation')
unique(prop.plot$lambda)
#   if(i == 1){
df.out <- df.in[[1]]
df.N <- df.in[[3]]
df.save <- df.in[[2]]
df.out$lambda[is.na(df.out$lambda)] <- 0
df.save$lambda[is.na(df.out$lambda)] <- 0
df.N$lambda[is.na(df.out$lambda)] <- 0
#   if(i == 1){
df.out2 <- df.in2[[1]]
df.N2 <- df.in2[[3]]
df.save2 <- df.in2[[2]]
df.out2$lambda[is.na(df.out$lambda)] <- 0
df.save2$lambda[is.na(df.out$lambda)] <- 0
df.N2$lambda[is.na(df.out$lambda)] <- 0
df.plot <- rbind(df.out, df.out2)
df.plot$lambda[is.na(df.plot$lambda)] <- 0
df.plot$R0base <- 1000
head(df.plot)
unique(df.plot$lambda)
df.plot$lambda[df.plot$lambda == 0] <- 1
df.plot$R0base <- 1000
# Plot some stuff
prop.plot <- df.plot[df.plot$years>round(max(df.plot$years)/2),] %>%
group_by(model, run, Linf, SDR, K, tau, rho, lambda) %>%
dplyr::summarise( SSBcorRR0  = cor(SSBprop, recR0),
weightcorRR0  = cor(mweight, recR0),
agecorRR0  = cor(mage, recR0),
SSBcorRtot  = cor(SSBprop, rtot),
weightcorRtot  = cor(mweight, rtot),
agecorRtot  = cor(mage, rtot),
SSBcorRdev  = cor(SSBprop, Rresid),
weightcorRdev  = cor(mweight, Rresid),
agecorRdev  = cor(mage, Rresid)
) %>%
pivot_longer(9:17)
unique(prop.plot$lambda)
dodge <- position_dodge(width = 0.8)
ggplot(prop.plot,
aes(x = factor(SDR), y = value, fill = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.4,.4))+
scale_y_continuous('correlation')
p4 <- ggplot(prop.plot,
aes(x = factor(SDR), y = value, fill = factor(rho)))+geom_violin(position = dodge)+
geom_boxplot(width = .2, position = dodge)+
geom_hline(aes(yintercept = 0), linetype = 2)+
facet_grid(lambda ~ name)+theme_classic()+coord_cartesian(ylim = c(-.4,.4))+
scale_y_continuous('correlation')
ggsave(filename = 'figures/9-5/correlations.png', p3, width = 16, height = 12)
ggsave(filename = 'figures/9-5/correlations.png', p4, width = 16, height = 12)
head(df.plot)
ggplot(df.plot, aes(x = SSBprop, y = rec))+geom_point()
head(df.save)
F0 <- 0.1
nruns <- 50
years <- 50
nruns <- 100
rho <- c(.9)#, 0.3, 0.5, .9)
set.seed(123)
df.in <- 'fn_sims(  models = c('linear'),
recLambda = c('noBOFF','BOFF'),
nruns = nruns,
years = years,
tau = tau,
Linf = Linf,
maxage = maxage,
K = K,
t0 = 0,
SDR = 0.2,
F0 = F0,
M = M0,
tau_sel = tau_sel,
egg.scale = egg.scale,
R0 = R0,
rho = rho,
Fpast = F0,
lambda.in = c(0.1, 0.5, .8),
recruitment = 'BH_R',
lambda.slope = .9,
mortality = 'constant',
fishing.type = 'AR',
recruitment.type = 'AR'
)
df.in2 <- fn_sims(  models = c('linear'),
recLambda = c('noBOFF','BOFF'),
nruns = nruns,
years = years,
tau = tau,
Linf = Linf,
maxage = maxage,
nruns <- 100
rho <- c(.9)#, 0.3, 0.5, .9)
set.seed(123)
df.in <- fn_sims(  models = c('linear'),
recLambda = c('noBOFF','BOFF'),
nruns = nruns,
years = years,
tau = tau,
Linf = Linf,
maxage = maxage,
K = K,
t0 = 0,
SDR = 0.2,
F0 = F0,
M = M0,
tau_sel = tau_sel,
egg.scale = egg.scale,
R0 = R0,
rho = rho,
Fpast = F0,
lambda.in = c(0.1, 0.5, .8),
recruitment = 'BH_R',
lambda.slope = .9,
mortality = 'constant',
fishing.type = 'AR',
recruitment.type = 'AR'
)
df.in2 <- fn_sims(  models = c('linear'),
recLambda = c('noBOFF','BOFF'),
nruns = nruns,
years = years,
tau = tau,
Linf = Linf,
maxage = maxage,
K = K,
t0 = 0,
SDR = 1,
F0 = F0,
M = M0,
tau_sel = tau_sel,
egg.scale = egg.scale,
R0 = R0,
rho = rho,
Fpast = F0,
lambda.in = c(0.1, 0.5, .8),
recruitment = 'BH_R',
lambda.slope = .9,
mortality = 'constant',
fishing.type = 'AR',
recruitment.type = 'AR'
)
nruns <- 100
rho <- c(.9)#, 0.3, 0.5, .9)
set.seed(123)
df.in <- fn_sims(  models = c('linear'),
recLambda = c('noBOFF','BOFF'),
nruns = nruns,
years = years,
tau = tau,
Linf = Linf,
maxage = maxage,
K = K,
t0 = 0,
SDR = 0.2,
F0 = F0,
M = M0,
tau_sel = tau_sel,
egg.scale = egg.scale,
R0 = R0,
rho = rho,
Fpast = F0,
lambda.in = c(0.1, 0.5, .8),
recruitment = 'BH_R',
lambda.slope = .2,
mortality = 'constant',
fishing.type = 'AR',
recruitment.type = 'AR'
)
[[1]]
df.out <- df.in[[1]]
#   if(i == 1){
df.out <- df.in[[1]]
df.N <- df.in[[3]]
df.save <- df.in[[2]]
head(df.save)
head(df.out)
df.out$F0
head(df.out)
ggplot(df.out[df.out$run == 1,], aes(x = propOld, y= rec))+geom_point()
ggplot(df.out[df.out$run == 1,], aes(x = propOld, y= rec, color = lambda))+geom_point()
ggplot(df.out[df.out$run == 1,], aes(x = propOld, y= rec, color = factor(lambda)))+geom_point()
ggplot(df.out[df.out$run == 1,], aes(x = propOld, y= rec, color = factor(lambda)))+geom_point()+geom_smooth()
source('~/.active-rstudio-document')
F0 <- seq(0,1, length.out = 30)
B <- rep(0, t)
F0 <- seq(0,1, length.out = 30)
C <- rep(0, legnth(F0))
for(k in 1:length(F0)){
for(i in 1:(t-1)){
B[i+1] <- B[i]+r*B[i]*(1-r/K)-B[i]*F0[k]
Ctmp <- B[i]*F0[k]
}
C[K] <- Ctmp
}
C
F0 <- seq(0,1, length.out = 30)
C <- rep(0, length(F0))
for(k in 1:length(F0)){
for(i in 1:(t-1)){
B[i+1] <- B[i]+r*B[i]*(1-r/K)-B[i]*F0[k]
Ctmp <- B[i]*F0[k]
}
C[K] <- Ctmp
}
plot(F0,C)
F0
length(F0)
length(C)
C <- rep(0, length(F0))
k
i
for(k in 1:length(F0)){
for(i in 1:(t-1)){
B[i+1] <- B[i]+r*B[i]*(1-r/K)-B[i]*F0[k]
Ctmp <- B[i]*F0[k]
}
C[k] <- Ctmp
}
plot(F0,C)
Ctmp
F0
k
B
B[1] <- K
for(k in 1:length(F0)){
for(i in 1:(t-1)){
B[i+1] <- B[i]+r*B[i]*(1-r/K)-B[i]*F0[k]
Ctmp <- B[i]*F0[k]
}
C[k] <- Ctmp
}
C
plot(C)
plot(F0,C)
which.max(C)
max(C)
C
plot(B)
B
C <- B <- matrix(NA, length(t), length(F0))
B
K <- 1000
t <- 50
r <- 0.2
B <- rep(0, t)
F0 <- seq(0,1, length.out = 30)
C <- B <- matrix(NA, t, length(F0))
r*K/4
dim(B)
B[1,] <- K
B
F0 <- seq(0,1, length.out = 30)
C <- B <- matrix(NA, t, length(F0))
B[1,] <- K
for(k in 1:length(F0)){
for(i in 1:(t-1)){
B[i+1,k] <- B[i,k]+r*B[i,k]*(1-r/K)-B[i,k]*F0[k]
C[i,k] <- B[i,k]*F0[k]
}
}
B
dim(B)
plot(B[,1])
B[1,]
t
k <- 1
i <- 1
B[i,k]
F0 <- seq(0,1, length.out = 30)
C <- B <- matrix(NA, t, length(F0))
B[1,] <- K
for(k in 1:length(F0)){
for(i in 1:(t-1)){
B[i+1,k] <- B[i,k]+r*B[i,k]*(1-B[i,k]/K)-B[i,k]*F0[k]
C[i,k] <- B[i,k]*F0[k]
}
}
plot(B[,1])
plot(B[,2])
plot(B[,3])
plot(B[,28])
plot(F0, C[,t])
plot(F0, C[t,])
dim(C)
F0
C[t,]
C[50,]
C
dim(C)
C[50,]
C[49,]
plot(F0, C[49,])
plot(F0, C[49,], type = 'l')
max(C)
max(C, na.rm = TRUE)
max(C[49,], na.rm = TRUE)
