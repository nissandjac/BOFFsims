}
}
}
years <- 100
for(k in 1:length(models)){
for(j in 1:length(recLambda)){
for(p in 1:length(F0)){
df.save <- data.frame(years = rep(1:years, nruns),
F0 = F0[p],
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = years),
model = paste(models[k],recLambda[j],paste('F0 = ',F0[p],sep =''), sep = '-'))
for(i in 1:nruns){
set.seed(seeds[i])
if(models[k] == 'linear'){
negg = egg.df$parameters[['alpha.lin']]
eggbeta = egg.df$parameters[['beta.lin']]
}
if(models[k] == 'hyper'){
negg = egg.df$parameters[['alpha.hyper']]
eggbeta = egg.df$parameters[['beta.hyper']]
}
if(recLambda[j] == 'noBOFF'){
lambda = NA
}
if(recLambda[j] == 'BOFF'){
lambda = lambda.in
}
df <- load_data_seasons(nseason = 1,
nyear = years,# Set up parameters
Linf = Linf,
maxage = maxage,
K = K,
t0 = t0,
M = M,
SDR = SDR, # Recruitment deviations
fishing.type = fishing.type,
mortality = mortality,
alpha = alpha,
beta = beta,
recruitment = recruitment,
recruitment.type = recruitment.type,
negg = negg,
eggbeta = eggbeta,
F0 = F0[p],
R0 = R0,
lambda = lambda,
lambda.slope = lambda.slope) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save[df.save$run == i,]$SSB <- tmprun$SSB
df.save[df.save$run == i,]$R <- tmprun$R.save
df.save[df.save$run == i,]$Rtot <- tmprun$Rtot.save
df.save[df.save$run == i,]$Catch <- tmprun$Catch
df.save[df.save$run == i,]$F0 <- F0[p]
}
df.sum <- df.save %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(Catch, probs = 0.95)
)
if(j == 1 & k == 1){
df.sum.out <- df.sum
df.save.out <- df.save
}else{
df.sum.out <- rbind(df.sum.out, df.sum)
df.save.out <- rbind(df.save.out,df.save)
}
}
}
}
source('~/GitHub/BOFFsims/R/runScenarios.R')
library(reshape2)
library(gtools)
library(patchwork)
library(tidyverse)
library(TMB)
source('R/calcSSB0.R')
source('R/run_agebased_model_true_Catch.R')
source('R/load_data_seasons.R')
source('R/est_eggs.R')
source('R/plotRecruitment.R')
source('R/getEquilibrium.R')
source('R/runScenarios.R')
# Load the data frame with eggs
eggs <- read.csv('data/fecundityEggSizeFemaleSize.csv')
eggs$weight <- 0.01*(eggs$FemaleSize_mm/10)^3 # Fix this later
# All eggs as a function of size
eggs <- eggs %>% group_by(Species) %>% mutate(relweight = weight/max(weight),
releggs = Fecundity_nOfEggs_per_female/max(Fecundity_nOfEggs_per_female)
)
x <- eggs[is.na(eggs$relweight) == 0,]$relweight
y <- eggs[is.na(eggs$relweight) == 0,]$releggs
# all relative eggs
parms <- est_eggs(x,y)
# Just take the cod eggs most of the other fish are not really big fisheries
cod <- eggs[eggs$Species == 'Gadus morhua',]
cod$weight <- 0.01*(cod$FemaleSize_mm/10)^3 # Fix the parameters for weight lenght to whatever here
codest <- est_eggs(x = cod$weight,
y = cod$Fecundity_nOfEggs_per_female)
ggplot(codest$df[codest$df$model != 'data',],
aes(x =  weight, y = estimate/weight, color = model))+geom_line()+theme_bw()
nruns <- 100
saving <- TRUE
seeds <- round(runif(n = nruns, min = 1,  max = 1e6))
# Punch in life history parameters (these are standard in run scenario)
tau <- 5
Linf <- 150
maxage <- 10
K <- 0.6
t0 <- 0
SDR <- 0.5
F0 <- 0.2
R0 <- 1000
M <- 0.4
recruitment <- 'BH_R'
lambda.slope <- .3
ls.plot <- runScenarios(models = c('linear','hyper'),
recLambda = c('noBOFF','BOFF'),
runLambda = FALSE,
lambda.in = .4,
egg.df = codest,
lambda.slope = lambda.slope,
SDR = SDR,
F0 = c(0.2, 0.5, 0.7))
str(ls.plot)
str(ls.plot[[1]])
head(ls.plot[[1]])
source('~/GitHub/BOFFsims/R/runScenarios.R')
ls.plot[[2]]
head(ls.plot[[2]])
source('~/GitHub/BOFFsims/R/runScenarios.R')
unique(ls.plot[[2]]$F0)
ls.plot <- runScenarios(models = c('linear','hyper'),
recLambda = c('noBOFF','BOFF'),
runLambda = FALSE,
lambda.in = .4,
egg.df = codest,
lambda.slope = lambda.slope,
SDR = SDR,
F0 = c(0.2, 0.5, 0.7))
source('~/GitHub/BOFFsims/R/runScenarios.R')
ls.plot <- runScenarios(models = c('linear','hyper'),
recLambda = c('noBOFF','BOFF'),
runLambda = FALSE,
lambda.in = .4,
egg.df = codest,
lambda.slope = lambda.slope,
SDR = SDR,
F0 = c(0.2, 0.5, 0.7))
head(ls.plot[[2]])
ls.plot[[1]]$F0 == 0.2
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p3 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p4 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = Rtot, color = model, fill = model))+
geom_line()+theme_classic()
p4
p1/p2/p3/p4
lambda.slope <- .7
ls.plot <- runScenarios(models = c('linear','hyper'),
recLambda = c('noBOFF','BOFF'),
runLambda = FALSE,
lambda.in = .4,
egg.df = codest,
lambda.slope = lambda.slope,
SDR = SDR,
F0 = c(0.2, 0.5, 0.7))
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p3 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p4 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = Rtot, color = model, fill = model))+
geom_line()+theme_classic()
p1/p2/p3/p4
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50,], aes(x = years, y = S, z = F0))+geom_tile()+theme_classic()
p1
ls.plot[[1]][ls.plot[[1]]$years > 50,]
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50,], aes(x = years, y = F0, z = S))+geom_tile()+theme_classic()
p1
str(ls.plot[[1]])
head(ls.plot[[1]])
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y = F0, z = S))+geom_tile()+theme_classic()
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y = F0, z = S))+geom_line()+theme_classic()
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S))+geom_line()+theme_classic()
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S))+geom_violin()+theme_classic()
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S, group = F0))+geom_violin()+theme_classic()
p5
head(ls.plot[[2]])
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =S, group = F0))+geom_violin()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, group = F0))+geom_violin()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB))+geom_violin()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = as.factor(F0), y =SSB))+geom_violin()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years > 99,], aes(x = as.factor(F0), y =SSB))+geom_violin()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years > 99,], aes(x = as.factor(F0), y =R))+geom_violin()+theme_classic()
p5
ls.plot <- runScenarios(models = c('linear','hyper'),
recLambda = c('noBOFF','BOFF'),
runLambda = FALSE,
lambda.in = .4,
egg.df = codest,
lambda.slope = lambda.slope,
SDR = SDR,
F0 = seq(0,1, length.out = 15))
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p1
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.2,], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.0,], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p1
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.0,], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.,], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()
p3 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.0,], aes(x = years, y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p4 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == 0.0,], aes(x = years, y = Rtot, color = model, fill = model))+
geom_line()+theme_classic()
# p4
p1/p2/p3/p4
Fin <- seq(0,1, length.out = 15)
Fin
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()
p3 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p4 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rtot, color = model, fill = model))+
geom_line()+theme_classic()
# p4
p1/p2/p3/p4
ls.plot[[1]]$model
head(ls.plot[[1]])
source('~/GitHub/BOFFsims/R/runScenarios.R')
ls.plot <- runScenarios(models = c('linear','hyper'),
recLambda = c('noBOFF','BOFF'),
runLambda = FALSE,
lambda.in = .4,
egg.df = codest,
lambda.slope = lambda.slope,
SDR = SDR,
F0 = Fin)
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()
p3 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()
p4 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rtot, color = model, fill = model))+
geom_line()+theme_classic()
p1/p2/p3/p4
getwd()
png('figures/boff_stuff_combined.png', res = 400, width = 20, height = 15, units = 'cm')
p1/p2/p3/p4
dev.off()
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'top')
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p3 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p4 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rtot, color = model, fill = model))+
geom_line()+theme_classic()+theme(legend.position = 'none')
# p4
p1/p2/p3/p4
png('figures/boff_stuff_combined.png', res = 400, width = 20, height = 15, units = 'cm')
p1/p2/p3/p4
dev.off()
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years > 99,], aes(x = as.factor(F0), y =R))+geom_violin()+theme_classic()
p5
head(ls.plot[[2]])
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, z = R))+geom_tile()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, z = R))+geom_contour_filled()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, fill = R))+geom_contour_filled()+theme_classic()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, fill = R))+geom_raster()+theme_classic()
p5
dim(ls.plot[[2]][ls.plot[[2]]$years == 99,])
head(ls.plot[[2]][ls.plot[[2]]$years == 99,])
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, fill = R))+geom_raster()+theme_classic()+facet_wrap(~model)
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, z = R))+geom_contour_filled()+theme_classic()+facet_wrap(~model)
p5
warnings()
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, z = R))+stat_density2d_filled()+theme_classic()+facet_wrap(~model)
p5
?stat_density2d
?stat_density2d_filled
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, z = R))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =SSB, z = log(R)))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = F0, y =log(SSB), z = log(R)))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = SSB, y =R, z = F0))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = SSB, y =R, z = F0))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10()
p5
p5 <- ggplot(ls.plot[[2]][ls.plot[[2]]$years == 99,], aes(x = SSB, y =R, z = F0))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10(limit = c(1e-8, 1e6))
p5
head(ls.plot[[2]])
head(ls.plot[[1]])
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = S, y =Rec, z = F0))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)#+
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = S, y =Rec, z = F0))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10()
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S, z = rec))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10()
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S, z = Rec))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10()
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S, z = Rec))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10()+scale_fill_distiller(palette=4, direction=-1)
p5
?scale_fill_distiller
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S, z = Rec))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10()+scale_fill_fermenter(palette=4, direction=-1)
p5
?geom_density_2d_filled
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S))+geom_density2d_filled()+theme_classic()+facet_wrap(~model)+
scale_y_log10()+scale_x_log10()
p5
ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S, z = Rec, fill = Rec))+geom_contour()+theme_classic()+facet_wrap(~model)
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0, y =S, z = Rec, fill = Rec))+geom_contour()+theme_classic()+facet_wrap(~model)#+
p5
warnings()
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec))+geom_contour()+theme_classic()+facet_wrap(~model)#+
p5
head(ls.plot[[1]])
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec))+geom_line()+theme_classic()+facet_wrap(~model)#+
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model))+geom_line()+theme_classic()#+
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model))+geom_line()+theme_classic()#+
p6 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = S, color = model))+geom_line()+theme_classic()#+
p7 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = C, color = model))+geom_line()+theme_classic()#+
p8 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rtot, color = model))+geom_line()+theme_classic()#+
p5/p6/p7/p8
png('figures/boff_stuff_F0.png', res = 400, width = 20, height = 15, units = 'cm')
p5/p6/p7/p8
dev.off()
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model))+geom_line()+theme_classic()+theme(legend.position = 'top')
p6 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = S, color = model))+geom_line()+theme_classic()+theme(legend.position = 'none')
p7 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = C, color = model))+geom_line()+theme_classic()+theme(legend.position = 'none')
p8 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rtot, color = model))+geom_line()+theme_classic()+theme(legend.position = 'none')
png('figures/boff_stuff_F0.png', res = 400, width = 20, height = 15, units = 'cm')
p5/p6/p7/p8
dev.off()
p5/p6/p7/p8
png('figures/boff_stuff_F0.png', res = 400, width = 20, height = 15, units = 'cm')
p5/p6/p7/p8
dev.off()
head(ls.plot[[1]])
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Recmax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()+theme(legend.position = 'top')
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()+theme(legend.position = 'top')
p5
p6 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = S, color = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p6
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'top')
p6 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = S, color = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p5
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'top')
p6 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p5/p6
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.0, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p2
p1 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = S, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'top')
p2 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p3 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rec, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p4 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years > 50 & ls.plot[[1]]$F0 == Fin[4],], aes(x = years, y = Rtot, color = model, fill = model))+
geom_line()+theme_classic()+theme(legend.position = 'none')
# p4
p1/p2/p3/p4
png('figures/boff_stuff_combined.png', res = 400, width = 20, height = 15, units = 'cm')
p1/p2/p3/p4
dev.off()
p5 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rec, color = model, fill = model))+geom_line(size = 1.1)+
geom_ribbon(aes(ymin = Recmin, ymax = Rmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'top')
p6 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = S, color = model, fill = model))+geom_line(size = 1.1)+
geom_ribbon(aes(ymin = Smin, ymax = Smax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p7 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = C, color = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
p8 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = Rtot, color = model))+geom_line()+theme_classic()+theme(legend.position = 'none')
png('figures/boff_stuff_F0.png', res = 400, width = 20, height = 15, units = 'cm')
p5/p6/p7/p8
dev.off()
p7 <- ggplot(ls.plot[[1]][ls.plot[[1]]$years == 99,], aes(x = F0,y = C, color = model, fill = model))+geom_line()+
geom_ribbon(aes(ymin = Cmin, ymax = Cmax), show.legend = FALSE, alpha = 0.1, linetype = 0)+theme_classic()+theme(legend.position = 'none')
png('figures/boff_stuff_F0.png', res = 400, width = 20, height = 15, units = 'cm')
p5/p6/p7/p8
dev.off()
df
df <- load_data_seasons(nseason = 1,
nyear = years,# Set up parameters
Linf = Linf,
maxage = maxage,
tau = tau,
K = K,
t0 = t0,
M= M,
SDR = 0, # Recruitment deviations - set to zero to calculate lambda
fishing.type = 'constant',
mortality = 'constant',
recruitment = recruitment,
negg = codest$parameters[['alpha.lin']],
eggbeta = codest$parameters[['beta.lin']],
F0 = 0, # Set to zero to calc lambda
R0 = R0) # Specify parameters
years <- 100
df <- load_data_seasons(nseason = 1,
nyear = years,# Set up parameters
Linf = Linf,
maxage = maxage,
tau = tau,
K = K,
t0 = t0,
M= M,
SDR = 0, # Recruitment deviations - set to zero to calculate lambda
fishing.type = 'constant',
mortality = 'constant',
recruitment = recruitment,
negg = codest$parameters[['alpha.lin']],
eggbeta = codest$parameters[['beta.lin']],
F0 = 0, # Set to zero to calc lambda
R0 = R0) # Specify parameters
df$lambda
df$lambda <- .3
(exp(-df$lambda.slope*(x-df$lambda)))
x
tmp
tmp <- run.agebased.true.catch(df)
N.save.age <- tmp$N.save.age
df$F0
# Regulate R0 based on the lambda function
x <- sum(N.save.age[df$age >= df$tau,yr,,]*df$Matsel[df$age >= df$tau]*df$egg.size[df$age >= df$tau])/
sum(N.save.age[,yr,,]*df$Matsel*df$egg.size, na.rm  =TRUE)
yr <- 50
# Regulate R0 based on the lambda function
x <- sum(N.save.age[df$age >= df$tau,yr,,]*df$Matsel[df$age >= df$tau]*df$egg.size[df$age >= df$tau])/
sum(N.save.age[,yr,,]*df$Matsel*df$egg.size, na.rm  =TRUE)
x
(exp(-df$lambda.slope*(x-df$lambda)))
df$tau
## Illustrate Lambda
x <- seq(0.01, .99, length.out = 50)
## Illustrate Lambda
x <- seq(0.01, .99, length.out = 50)
lambda <- 0.4
lambda.slope <- 0.7
R0 <- 100*(exp(-lambda.slope*(x-lambda)))
plot(x, R0)
R0 <- 100*1/(exp(-lambda.slope*(x-lambda)))
plot(x, R0)
df.plot <- data.frame(x = x, R0 = R0)
ggplot(df.plot, aes(x = x, y = R0))+geom_line()+theme_classic()
ggplot(df.plot, aes(x = x, y = R0))+geom_line()+theme_classic()+geom_hline(aes(yintercept = 100))
ggplot(df.plot, aes(x = x, y = R0))+geom_line(size = 1.2)+theme_classic()+geom_hline(aes(yintercept = 100), linetype = 2)
ggplot(df.plot, aes(x = x, y = R0))+geom_line(size = 1.2)+theme_classic()+geom_hline(aes(yintercept = 100), linetype = 2)+
geom_vline(aes(xintercept = lambda), linetype = 2)
png('figures/lambdacalc.png', width = 8, height = 8, res = 400, units = 'cm')
ggplot(df.plot, aes(x = x, y = R0))+geom_line(size = 1.2)+theme_classic()+geom_hline(aes(yintercept = 100), linetype = 2)+
geom_vline(aes(xintercept = lambda), linetype = 2)
dev.off()
df$tau
df$rho
source('~/GitHub/BOFFsims/R/runScenarios.R')
source('~/GitHub/BOFFsims/R/runScenarios.R')
source('~/GitHub/BOFFsims/R/runScenarios.R')
source('~/GitHub/BOFFsims/R/runScenarios.R')
