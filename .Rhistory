alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.hyper']],
eggbeta = codest$parameters[['beta.hyper']],
F0 = 0.5,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save.boff[df.save.boff$run == i,]$SSB <- tmprun$SSB
df.save.boff[df.save.boff$run == i,]$R <- tmprun$R.save
df.save.boff[df.save.boff$run == i,]$Rtot <- tmprun$Rtot.save
df.save.boff[df.save.boff$run == i,]$Catch <- tmprun$Catch
}
df.sum.boff <- df.save.boff %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
# Plot boff and not boff
df.plot <- rbind(df.save, df.save.boff)
df.sumplot <- rbind(df.sum, df.sum.boff)
ggplot(df.plot,aes(x = SSB, y = Rtot, color = model))+geom_point()+theme_classic()
# Dunnno why but this plot crashes
# ggplot(df.plot, aes(x= years, y = SSB, group = factor(run), color = model))+
#   geom_line(alpha = 0.1, size = .5)+
#   theme_bw()+theme(legend.position = 'none')+  geom_line(data = df.sumplot, aes(y = S, group = NA), size = 2)
ggplot(df.sumplot, aes(x = years, y = S, color = model))+geom_line()+theme_classic()+
#  geom_hline(aes(yintercept = tmprun$SSB_0))+
geom_ribbon(aes(ymin = Smin, ymax = Smax), fill = 'red', alpha = 0.1, linetype = 0)
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0., # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH',
negg = codest$parameters[['alpha.lin']],
eggbeta = codest$parameters[['beta.lin']],
F0 = 0.,
R0 = 1) # Specify parameters
tmp <- run.agebased.true.catch(df)
plot(tmp$SSB, type ='l', log = 'y')
plot(tmp$R.save, type ='l')
SSBtest <- seq(1, max(tmp$Rtot.save), length.out = 1000)
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$Rtot.save)))
points(tmp$Rtot.save,tmp$R.save)
df.save <- data.frame(years = rep(df$years, nruns),
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = length(df$years)),
model = 'linear')
# SSBtest <- seq(1, alpha/beta, length.out = 100)
# bhmodel <- (alpha*SSBtest)/(1+beta*SSBtest)
#
#
#
# bhmodel <- alpha*SSBtest *exp(-beta * SSBtest)#*exp(-0.5*df$b[yr]*SDR^2+Ry)#
# plot(SSBtest,bhmodel, type = 'l')
# lines(rep(1/beta, 100), y = seq(0,1e12, length.out =100))
for(i in 1:nruns){
set.seed(seeds[i])
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.hyper']],
eggbeta = codest$parameters[['beta.hyper']],
F0 = 0.1,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save[df.save$run == i,]$SSB <- tmprun$SSB
df.save[df.save$run == i,]$R <- tmprun$R.save
df.save[df.save$run == i,]$Rtot <- tmprun$Rtot.save
df.save[df.save$run == i,]$Catch <- tmprun$Catch
}
df.sum <- df.save %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
df.save.boff <- data.frame(years = rep(df$years, nruns),
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = length(df$years)),
model = 'boff')
for(i in 1:nruns){
set.seed(seeds[i])
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.hyper']],
eggbeta = codest$parameters[['beta.hyper']],
F0 = 0.1,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save.boff[df.save.boff$run == i,]$SSB <- tmprun$SSB
df.save.boff[df.save.boff$run == i,]$R <- tmprun$R.save
df.save.boff[df.save.boff$run == i,]$Rtot <- tmprun$Rtot.save
df.save.boff[df.save.boff$run == i,]$Catch <- tmprun$Catch
}
df.sum.boff <- df.save.boff %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
# Plot boff and not boff
df.plot <- rbind(df.save, df.save.boff)
df.sumplot <- rbind(df.sum, df.sum.boff)
ggplot(df.plot,aes(x = SSB, y = Rtot, color = model))+geom_point()+theme_classic()
# Dunnno why but this plot crashes
# ggplot(df.plot, aes(x= years, y = SSB, group = factor(run), color = model))+
#   geom_line(alpha = 0.1, size = .5)+
#   theme_bw()+theme(legend.position = 'none')+  geom_line(data = df.sumplot, aes(y = S, group = NA), size = 2)
ggplot(df.sumplot, aes(x = years, y = S, color = model))+geom_line()+theme_classic()+
#  geom_hline(aes(yintercept = tmprun$SSB_0))+
geom_ribbon(aes(ymin = Smin, ymax = Smax), fill = 'red', alpha = 0.1, linetype = 0)
for(i in 1:nruns){
set.seed(seeds[i])
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.lin']],
eggbeta = codest$parameters[['beta.lin']],
F0 = 0.1,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save[df.save$run == i,]$SSB <- tmprun$SSB
df.save[df.save$run == i,]$R <- tmprun$R.save
df.save[df.save$run == i,]$Rtot <- tmprun$Rtot.save
df.save[df.save$run == i,]$Catch <- tmprun$Catch
}
df.sum <- df.save %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
df.save.boff <- data.frame(years = rep(df$years, nruns),
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = length(df$years)),
model = 'boff')
for(i in 1:nruns){
set.seed(seeds[i])
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.hyper']],
eggbeta = codest$parameters[['beta.hyper']],
F0 = 0.1,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save.boff[df.save.boff$run == i,]$SSB <- tmprun$SSB
df.save.boff[df.save.boff$run == i,]$R <- tmprun$R.save
df.save.boff[df.save.boff$run == i,]$Rtot <- tmprun$Rtot.save
df.save.boff[df.save.boff$run == i,]$Catch <- tmprun$Catch
}
df.sum.boff <- df.save.boff %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
# Plot boff and not boff
df.plot <- rbind(df.save, df.save.boff)
df.sumplot <- rbind(df.sum, df.sum.boff)
ggplot(df.plot,aes(x = SSB, y = Rtot, color = model))+geom_point()+theme_classic()
# Dunnno why but this plot crashes
ggplot(df.sumplot, aes(x = years, y = S, color = model))+geom_line()+theme_classic()+
#  geom_hline(aes(yintercept = tmprun$SSB_0))+
geom_ribbon(aes(ymin = Smin, ymax = Smax), fill = 'red', alpha = 0.1, linetype = 0)
SSBtest <- seq(1, max(tmp$Rtot.save), length.out = 1000)
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$Rtot.save)))
points(tmp$Rtot.save,tmp$R.save)
df.save <- data.frame(years = rep(df$years, nruns),
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = length(df$years)),
model = 'linear')
for(i in 1:nruns){
set.seed(seeds[i])
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.lin']],
eggbeta = codest$parameters[['beta.lin']],
F0 = 0,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save[df.save$run == i,]$SSB <- tmprun$SSB
df.save[df.save$run == i,]$R <- tmprun$R.save
df.save[df.save$run == i,]$Rtot <- tmprun$Rtot.save
df.save[df.save$run == i,]$Catch <- tmprun$Catch
}
df.sum <- df.save %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
df.save.boff <- data.frame(years = rep(df$years, nruns),
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = length(df$years)),
model = 'boff')
for(i in 1:nruns){
set.seed(seeds[i])
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.hyper']],
eggbeta = codest$parameters[['beta.hyper']],
F0 = 0,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save.boff[df.save.boff$run == i,]$SSB <- tmprun$SSB
df.save.boff[df.save.boff$run == i,]$R <- tmprun$R.save
df.save.boff[df.save.boff$run == i,]$Rtot <- tmprun$Rtot.save
df.save.boff[df.save.boff$run == i,]$Catch <- tmprun$Catch
}
df.sum.boff <- df.save.boff %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
# Plot boff and not boff
df.plot <- rbind(df.save, df.save.boff)
df.sumplot <- rbind(df.sum, df.sum.boff)
ggplot(df.plot,aes(x = SSB, y = Rtot, color = model))+geom_point()+theme_classic()
ggplot(df.sumplot, aes(x = years, y = S, color = model))+geom_line()+theme_classic()+
#  geom_hline(aes(yintercept = tmprun$SSB_0))+
geom_ribbon(aes(ymin = Smin, ymax = Smax), fill = 'red', alpha = 0.1, linetype = 0)
SSBtest <- seq(1, max(tmp$Rtot.save), length.out = 1000)
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$Rtot.save)))
points(tmp$Rtot.save,tmp$R.save)
df.save <- data.frame(years = rep(df$years, nruns),
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = length(df$years)),
model = 'linear')
for(i in 1:nruns){
set.seed(seeds[i])
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.lin']],
eggbeta = codest$parameters[['beta.lin']],
F0 = 0,
R0 = 100) # Specify parameters
tmprun <- run.agebased.true.catch(df, seed = seeds[i])
df.save[df.save$run == i,]$SSB <- tmprun$SSB
df.save[df.save$run == i,]$R <- tmprun$R.save
df.save[df.save$run == i,]$Rtot <- tmprun$Rtot.save
df.save[df.save$run == i,]$Catch <- tmprun$Catch
}
df.sum <- df.save %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
df.save.boff <- data.frame(years = rep(df$years, nruns),
SSB = NA,
R = NA,
Rtot = NA,
Catch = NA,
run = rep(1:nruns, each = length(df$years)),
model = 'boff')
for(i in 1:nruns){
set.seed(seeds[i])
dfb <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0.0, # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.hyper']],
eggbeta = codest$parameters[['beta.hyper']],
F0 = 0,
R0 = 100) # Specify parameters
tmprunb <- run.agebased.true.catch(dfb, seed = seeds[i])
df.save.boff[df.save.boff$run == i,]$SSB <- tmprunb$SSB
df.save.boff[df.save.boff$run == i,]$R <- tmprunb$R.save
df.save.boff[df.save.boff$run == i,]$Rtot <- tmprunb$Rtot.save
df.save.boff[df.save.boff$run == i,]$Catch <- tmprunb$Catch
}
df.sum.boff <- df.save.boff %>% group_by(years, model) %>%
summarise(S = median(SSB),
Rec = median(R),
C = median(Catch),
Rtot = median(Rtot),
Smin = quantile(SSB, probs = 0.05),
Smax = quantile(SSB, probs = 0.95),
Recmin = quantile(R, probs = 0.05),
Rmax = quantile(R, probs = 0.95),
Cmin = quantile(Catch, probs = 0.05),
Cmax = quantile(SSB, probs = 0.95)
)
# Plot boff and not boff
df.plot <- rbind(df.save, df.save.boff)
df.sumplot <- rbind(df.sum, df.sum.boff)
ggplot(df.plot,aes(x = SSB, y = Rtot, color = model))+geom_point()+theme_classic()
ggplot(df.sumplot, aes(x = years, y = S, color = model))+geom_line()+theme_classic()+
#  geom_hline(aes(yintercept = tmprun$SSB_0))+
geom_ribbon(aes(ymin = Smin, ymax = Smax), fill = 'red', alpha = 0.1, linetype = 0)
head(df.save.boff)
head(df.save.boff$R/df.save.boff$Rtot)
plot(df.save.boff$R/df.save.boff$Rtot)
plot(df.save$R/df.save$Rtot)
#
SSBtest <- seq(1, alpha/beta+100, length.out = 1000)
bhmodel <- plotRecruitment('BH', S = SSBtest, df = list(alpha = alpha, beta = beta))
plot(SSBtest,bhmodel, type = 'l', ylab = 'recruitment', xlab = 'egg production')
df <- load_data_seasons(nseason = 1,
nyear = 200,# Set up parameters
Linf = 150,
maxage = 10,
h = 0.4,
K = .4,
t0 = 0,
SDR = 0., # Recruitment deviations
fishing.type = 'constant',
mortality = 'constant',
alpha = alpha,
beta = beta,
recruitment = 'BH_steep',
negg = codest$parameters[['alpha.lin']],
eggbeta = codest$parameters[['beta.lin']],
F0 = 0.,
R0 = 1) # Specify parameters
tmp <- run.agebased.true.catch(df)
plot(tmp$SSB, type ='l', log = 'y')
plot(tmp$R.save, type ='l')
SSBtest <- seq(1, max(tmp$Rtot.save), length.out = 1000)
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$Rtot.save)))
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$Rtot.save)))
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
source('~/GitHub/BOFFsims/R/plotRecruitment.R')
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
source('~/GitHub/BOFFsims/R/plotRecruitment.R')
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$Rtot.save)))
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
source('~/GitHub/BOFFsims/R/plotRecruitment.R')
SSBtest <- seq(1, max(tmp$Rtot.save), length.out = 1000)
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$Rtot.save)))
points(tmp$Rtot.save,tmp$R.save)
tmp$R.save
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$R.save)))
points(tmp$Rtot.save,tmp$R.save)
SSBtest <- seq(1, max(tmp$Rtot.save), length.out = 1000)
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$R.save)))
points(tmp$Rtot.save,tmp$R.save)
plot(SSBtest,bhmodel, type = 'l', xlim = c(0,max(tmp$Rtot.save)), ylim = c(0,max(tmp$R.save)),
log = 'y')
points(tmp$Rtot.save,tmp$R.save)
SSBtest <- seq(1, max(tmp$Rtot.save), length.out = 1000)
bhmodel <- plotRecruitment('BH_steep', S = SSBtest, df = df)
plot(SSBtest,bhmodel, type = 'l', xlim = c(1,max(tmp$Rtot.save)), ylim = c(1,max(tmp$R.save)),
log = 'y')
points(tmp$Rtot.save,tmp$R.save)
